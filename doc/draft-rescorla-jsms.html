<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>JavaScript Message Security Format</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="JavaScript Message Security Format">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Rescorla</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">RTFM, Inc.</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">J. Hildebrand</td></tr>
<tr><td class="header">Expires:  September 8, 2011</td><td class="header">Cisco Systems, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 7, 2011</td></tr>
</table></td></tr></table>
<h1><br />JavaScript Message Security Format<br />draft-rescorla-jsms-00.txt</h1>

<h3>Abstract</h3>

<p>Many applications require the ability to send
      cryptographically secured messages. While the IETF has defined a
      number of formats for such messages (e.g. CMS) those formats use
      encodings which are not congenial for Web applications. This
      document describes a new cryptographic message format which is
      based on JavaScript Object Notation (JSON) and thus is easy for
      Web applications to generate and parse.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on September 8, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions Used In This Document<br />
<a href="#anchor3">3.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Operational Modes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Certificate Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
Certificate Discovery<br />
<a href="#anchor8">4.</a>&nbsp;
Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.base64">4.1.</a>&nbsp;
Base64 Handling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.content">4.2.</a>&nbsp;
Content Object<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.message-common">4.3.</a>&nbsp;
Common Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.signed">4.4.</a>&nbsp;
Signed Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.signature_computation">4.4.1.</a>&nbsp;
Signature Computation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.signature_verification">4.4.2.</a>&nbsp;
Signature Verification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.encrypted">4.5.</a>&nbsp;
Encrypted Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.encryption">4.5.1.</a>&nbsp;
Message Encryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.decryption">4.5.2.</a>&nbsp;
Message Decryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.key_derivation">4.5.3.</a>&nbsp;
Key Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.encrypt_cmk">4.5.4.</a>&nbsp;
CMK Encryption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.msg-composition">4.6.</a>&nbsp;
Composition<br />
<a href="#sec.version">5.</a>&nbsp;
Version Processing<br />
<a href="#sec.iana-cons">6.</a>&nbsp;
IANA Considerations<br />
<a href="#sec.sec-cons">7.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#anchor11">Appendix&nbsp;A.</a>&nbsp;
JSON Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.content">A.1.</a>&nbsp;
Message Contents Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.common">A.2.</a>&nbsp;
Common Elements Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.signed">A.3.</a>&nbsp;
Signed Message Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.PKIXcertchain">A.4.</a>&nbsp;
PKIX Certificate Chain Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.ecncrypted">A.5.</a>&nbsp;
Encrypted Message Schema<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema.recipient">A.6.</a>&nbsp;
Recipient Schema<br />
<a href="#anchor12">Appendix&nbsp;B.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Many applications require the ability to send
      cryptographically secured (encrypted, digitally signed, etc.)
      messages. While the IETF has defined a number of formats for
      such messages, those formats are widely viewed as being
      excessively complicated for the demands of Web applications,
      which typically only need the ability to secure simple
      messages. In addition, existing formats use encoding mechanisms
      (e.g., ASN.1 BER/DER) which are not congenial for Web
      applications. This presents an obstacle to the deployment of
      strong security by such applications.
</p>
<p>This document describes a new cryptographic message format,
      JavaScript Message Security (JSMS) intended to meet the need of
      the Web environment. While JSMS is modeled on existing formats
      -- principally CMS <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a> -- it uses
      JavaScript Object Notation (JSON) rather than ASN.1/BER/DER,
      making it far easier for Web applications to handle. In the
      interest of simplicity, JSMS also omits as many as possible of
      the CMS modes (multiple signatures, password-based
      encryption).
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used In This Document</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>The JSMS message format is simply a JSON <a class='info' href='#RFC4627'>[RFC4627]<span> (</span><span class='info'>Crockford, D., &ldquo;The application/json Media Type for JavaScript Object Notation (JSON),&rdquo; July&nbsp;2006.</span><span>)</span></a> dictionary with an appropriate
      collection of fields.  Each operating mode will have a separate
      set of fields, with a common field to distinguish between the
      modes.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Operational Modes</h3>

<p>JSMS supports two operational modes:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Encrypted Data</dt>
<dd>
</dd>
<dt></dt>
<dd>A block of data encrypted under a random message
            encryption key (MEK). The MEK is then separately encrypted
            for each recipient, either via symmetric or asymmetric
            encryption. The data is always integrity protected, either
            via a separate Message Authentication Code (MAC) or an
            Authenticated Encryption with Associated Data (AEAD)
            algorithm such as AES-GCM or AES-CCM.
</dd>
<dt>Signed Data</dt>
<dd>
</dd>
<dt></dt>
<dd>A block of data signed by a single signer using his asymmetric
            key and optionally carrying his certificate. Multiple signatures
            are not permitted in order to keep things simple.
</dd>
</dl></blockquote>

<p>Any other desired security functions are provided by composition of
        these modes. For instance, a signed and encrypted message is produced
        by first creating a Signed message and then encrypting that data. (See
        <a class='info' href='#sec.msg-composition'>Section&nbsp;4.6<span> (</span><span class='info'>Composition</span><span>)</span></a> for more on
        composition.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Conventions</h3>

<p>In general, JSMS follows the following structural conventions:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Minimize implementation complexity</dt>
<dd>
</dd>
<dt></dt>
<dd>Wherever possible, protocol choices have been made such
          that the time and effort required to implement the protocol
          in many different programming languages will be minimized.
          This means that optimizations for bandwidth, CPU, and memory
          utilization have been explicitly avoided.
</dd>
<dt>Base64 as the only encoding</dt>
<dd>
</dd>
<dt></dt>
<dd>Any data that does not have a straightforward string
          representation (binary values, large integers, etc.) is
          base64-encoded (see: <a class='info' href='#RFC4648'>[RFC4648]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>). In
          some cases, hexadecimal encodings might be more convenient,
          but consistency is even more important to reduce
          implementation complexity.
</dd>
<dt>No canonicalization</dt>
<dd>
</dd>
<dt></dt>
<dd>In many cryptographic message formats, canonical
          encodings are used to allow the same value to be computed at
          both sender and recipient (e.g., for digital
          signatures). This is inconvenient in JSON, which just views
          messages as a bundle of key/value pairs. Instead, whenever
          canonicalization would be required, the relevant data is
          serialized and base64-encoded for transport, allowing both
          sides to run computations over the same original set of
          octets.
</dd>
<dt>In-memory processing</dt>
<dd>
</dd>
<dt></dt>
<dd>We assume that the entire message can fit in main memory
          and make no effort to design a wire representation which can
          be handled in small chunks in a single pass. This means, for
          instance, that there is no need to have a message digest
          indicator at the beginning of the message and then the
          signature at the end, as is done in CMS. Fields are simply
          serialized in whatever order is most convenient for the JSON
          implementation. The examples in this document are generally
          shown in whatever order seems most readable and are not
          normative.
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Certificate Processing</h3>

<p>Experience has shown that certificate handling (path
        construction) is one of the trickier parts of building a
        cryptographic system. While JSMS supports PKIX certificates,
        its certificate processing is far simpler than that of
        CMS. When a JSMS agent provides its certificate, it must
        provide an ordered chain (as in TLS <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>)
        terminating in its own certificate, thus removing the need to
        construct certificate paths. The certificates MUST be ordered
        with the end-entity certificate first and each certificate
        that follows signing the certificate immediately preceding it.
        In addition, because many implementations will not want to do
        any ASN.1/BER processing at all, we will define a Web Service
        which applications can use for chain validation and
        translation to an easy-to-parse format. (See [TODO]).
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Certificate Discovery</h3>

<p>JSMS will often be used in an online messaging environment
        with users that have an address of the form user@domain, such as
        email, XMPP, or SIP.  As such, protocols such as WebFinger
        <a class='info' href='#I-D.hammer-webfinger'>[I&#8209;D.hammer&#8209;webfinger]<span> (</span><span class='info'>Hammer-Lahav, E., Fitzpatrick, B., and B. Cook, &ldquo;The WebFinger Protocol,&rdquo; October&nbsp;2009.</span><span>)</span></a> or an end-to-end
        protocol can be used to retrieve appropriate certificates.
        Downstream uses of JSMS SHOULD define a discovery mechanism
        suitable for the intended use.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Message Format</h3>

<p>All of the field definitions in this section make use of JSON
      Schema <a class='info' href='#I-D.zyp-json-schema'>[I&#8209;D.zyp&#8209;json&#8209;schema]<span> (</span><span class='info'>Zyp, K. and G. Court, &ldquo;A JSON Media Type for Describing the Structure and Meaning of JSON Documents,&rdquo; November&nbsp;2010.</span><span>)</span></a>.  For each of the
      fields that is designed to hold an enumerated value, a registry
      will be created allowing other values to be used in addition to
      the values enumerated in the schema.
</p>
<a name="sec.base64"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Base64 Handling</h3>

<p>As stated in section 3.1 of <a class='info' href='#RFC4648'>[RFC4648]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>,
        Base64 does not require linefeeds after a specific number of
        characters.  Since linefeeds are not valid characters in a
        JSON string, whenever a field is specified to be
        Base64-encoded in this document, it MUST NOT include any line
        breaks.  Base64-encoded fields also MUST NOT include
        JSON-encoded linefeeds such as "\n".  Any linebreaks in the
        middle of Base64-encoded sections of the examples are
        unintended side-effects of the production process.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Implementation Note:</dt>
<dd>Much existing Base64-encoding code
              will generate linefeeds every 64 or 76 characters of output.
              Ensure that these linefeeds are removed before inserting the
              output into a JSON structure.
</dd>
</dl></blockquote>

<a name="sec.content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Content Object</h3>

<p>JSMS operates by providing transformations on "Content" objects,
        which are just mime-typed JSON objects. These objects are then wrapped
        in a signed/encrypted wrapper with the following fields:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>ContentType:</dt>
<dd>A MIME <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>
            media type that MUST be included indicating the type of
            the "Data" field.
</dd>
<dt>Type:</dt>
<dd>The constant string "content", to
            facilitate easy determination that this is the target
            content.  This is useful (for example) in certain
            operating conditions where you must continue to unwrap
            layers of signatures until you get to the content.  This
            field MUST be included.
</dd>
<dt>Data:</dt>
<dd>The data value MUST be included as a
            text encoded as Base64 (See: <a class='info' href='#RFC4648'>[RFC4648]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>).
</dd>
<dt>ID:</dt>
<dd>An OPTIONAL universally unique ID that
            identifies this message, for use in detecting replay
            attacks.
</dd>
<dt>Created:</dt>
<dd>An OPTIONAL field describing the UTC
            date/time that the content was encoded into JSON, formatted
            according to the "date-time" production of <a class='info' href='#RFC3339'>[RFC3339]<span> (</span><span class='info'>Klyne, G., Ed. and C. Newman, &ldquo;Date and Time on the Internet: Timestamps,&rdquo; July&nbsp;2002.</span><span>)</span></a>.
</dd>
</dl></blockquote>

<p>Signing and encryption transform a "Content" object into "Signed"
        and "Encrypted" objects respectively. Verification and decryption
        transform "Signed" and "Encrypted" objects back into "Content"
        objects. For example:
</p><br /><hr class="insert" />
<a name="fig.content"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "ContentType":"text/plain; charset=UTF-8",
    "Type":"content",
    "Data":"SGVsbG8sIFdvcmxkCg==",
    "ID":"746a4c9f-8e84-4313-b669-81590ee2949e",
    "Created":"2011-03-07T16:17Z"
}</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Content Example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="sec.message-common"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Common Elements</h3>

<p>A JSMS message is a JSON dictionary object containing a set
        of specific values.
</p>
<p>The following fields MUST be present in all messages:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>Version:</dt>
<dd>The version number. For this specification
            this value MUST be set to the string "1.0".  See <a class='info' href='#sec.version'>Section&nbsp;5<span> (</span><span class='info'>Version Processing</span><span>)</span></a> for details on version handling.
</dd>
<dt></dt>
<dd>
</dd>
<dt>Type:</dt>
<dd>The type of the message. MUST be either
            "signed" or "encrypted", to indicate a signed message (<a class='info' href='#sec.signed'>Section&nbsp;4.4<span> (</span><span class='info'>Signed Data</span><span>)</span></a>) or an encrypted message (<a class='info' href='#sec.encrypted'>Section&nbsp;4.5<span> (</span><span class='info'>Encrypted Data</span><span>)</span></a>) respectively.
</dd>
</dl></blockquote>

<a name="sec.signed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Signed Data</h3>

<p>A "signed" message contains a signed data block plus a digital
        signature over that data. To simplify implementation, only one
        signer is allowed. In addition to the required fields from <a class='info' href='#sec.message-common'>Section&nbsp;4.3<span> (</span><span class='info'>Common Elements</span><span>)</span></a>, the fields in a signature
        message are:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>SignedData:</dt>
<dd>This field MUST consist of a
            Base64-encoded "Content" structure (see <a class='info' href='#sec.content'>Section&nbsp;4.2<span> (</span><span class='info'>Content Object</span><span>)</span></a>), which MUST have been
            encoded into octets as UTF-8 prior to Base64-encoding.
            The signature is computed over the UTF-8 octet stream
            before Base64-encoding to ensure that the sender and
            receiver have the exact same representation.
</dd>
<dt></dt>
<dd>
</dd>
<dt>DigestAlgorithm:</dt>
<dd>The message digest used to compute
            the signature. This field MUST be present for RSA-based signatures
            but MAY be omitted for future signatures which do not allow
            flexible digests.  For now, this field MUST have the value
            "SHA-256", meaning the digest algorithm was SHA-256 
        <a class='info' href='#FIPS-180-3'>[FIPS&#8209;180&#8209;3]<span> (</span><span class='info'>National Institute of Standards and Technology (NIST), &ldquo;Secure Hash Standard (SHS),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
        
</dd>
<dt></dt>
<dd>
</dd>
<dt>SignatureAlgorithm:</dt>
<dd>The signature algorithm used to
            compute the signature. This field MUST be present.  For
            now, this field MUST have the value "RSA-PKCS1-1.5",
            meaning the signature algorithm was RSASSA-PKCS1-v1_5 as
            specified in <a class='info' href='#RFC3447'>[RFC3447]<span> (</span><span class='info'>Jonsson, J. and B. Kaliski, &ldquo;Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1,&rdquo; February&nbsp;2003.</span><span>)</span></a>.
</dd>
<dt></dt>
<dd>
</dd>
<dt>Signer:</dt>
<dd>The signer's identity, expressed as a URI
            <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>. This field MUST be present.
</dd>
<dt></dt>
<dd>
</dd>
<dt>CertChain:</dt>
<dd>The signer's certificate chain, if any
            (see <a class='info' href='#sec.certificates'>Section&nbsp;4.4.2.1<span> (</span><span class='info'>Certificate Processing</span><span>)</span></a>).
</dd>
<dt></dt>
<dd>
</dd>
<dt>Signature:</dt>
<dd>The Base64-encoded signature, which
            MUST be included (see <a class='info' href='#sec.signature_computation'>Section&nbsp;4.4.1<span> (</span><span class='info'>Signature Computation</span><span>)</span></a>).
</dd>
</dl></blockquote>
<br /><hr class="insert" />
<a name="fig.signed"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "SignedData":"ewogICAgIkNvbnRlbnRUeXBlIjoidGV4dC9wbGFpbjsgY2hhcn
                  NldD1VVEYtOCIsCiAgICAiVHlwZSI6ImNvbnRlbnQiLAogICAg
                  IkRhdGEiOiJTR1ZzYkc4c0lGZHZjbXhrQ2c9PSIsCiAgICAiSU
                  QiOiI3NDZhNGM5Zi04ZTg0LTQzMTMtYjY2OS04MTU5MGVlMjk0
                  OWUiLAogICAgIkNyZWF0ZWQiOiIyMDExLTAzLTA3VDE2OjE3Wi
                  IKfQ==",
    "DigestAlgorithm":"SHA-256",
    "SignatureAlgorithm":"RSA-PKCS1-1.5",
    "Signer":"xmpp:romeo@example.net",
    "Signature":"sNsxJltUaz4pSzAtJiPZagUMV4SwWugWexGbffK/WJRDi2uq7TxN
                 /V9SwG/kvQ7CaTABbeUuc6cKGO5YxnH5hME3bHB5L9PKPWSjxzxo
                 68RPxQyPli2YJDDHKVPbofEa86CLqYcwTF5qrcL7fQFvlRSOVxpS
                 SJfIdiAJNA+nEnk="
}</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Signed Message Example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="sec.signature_computation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Signature Computation</h3>

<p>The signature is computed over the string prior to base64
          encoding. I.e., the processing order for encoding is:
</p>
<p></p>
<ol class="text">
<li>Serialize the inner "Content" value into a
              UTF8-encoded octet series X.
</li>
<li>Compute the signature value over X, and call the
              result Y. (In the case of signatures which use digests,
              this means feed the literal octets of the signature into
              the digest function.)
</li>
<li>Compute the Base64 representation of X and insert it into the
              "SignedData" field of the message.
</li>
<li>Compute the Base64 representation of Y, and insert the result
              into the "Signature" field.
</li>
</ol>

<p>This procedure removes dependencies on the exact serialization
          algorithm; variation in spacing, field order, etc. do not affect
          signature validity since the Base64 representation preserves them on
          the wire and protects them from modification by intermediaries.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>An alternative algorithm would be to compute
              the signature on the base64 representation itself, but this has
              two disadvantages: (1) any intermediaries which change
              spacing/line breaks would break the signature. (2) it is
              inconsistent with the algorithm for encryption (<a class='info' href='#sec.encrypted'>Section&nbsp;4.5<span> (</span><span class='info'>Encrypted Data</span><span>)</span></a>), which is designed to avoid
              multiple base64 encoding.
</dd>
</dl></blockquote>

<p>This procedure only specifies the input to the signature
          computation. The details of the computation depend on the signature
          algorithm itself. The mapping from code points to algorithms is
          found in <a class='info' href='#sec.iana-cons'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</p>
<a name="sec.signature_verification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
Signature Verification</h3>

<p>In order to verify the signature, the steps of the previous
          section are reversed.
</p>
<p></p>
<ol class="text">
<li>Process the provided "Signer" and "CertChain" fields as
              described in <a class='info' href='#sec.certificates'>Section&nbsp;4.4.2.1<span> (</span><span class='info'>Certificate Processing</span><span>)</span></a> in order to
              determine the sender's public key.
</li>
<li>Base64 decode the "SignedData" field in order to recover a string
              X.
</li>
<li>Verify the "Signature" field against X using the sender's
              public key and the "SignatureAlgorithm" and "DigestAlgorithm"
              fields. If the signature fails, return an error.
</li>
<li>Deserialize X to recover the inner "Content"
              value.
</li>
<li>Check any "ID" or "Created" fields for replay.
</li>
<li>Using the value of the "ContentType" field to give
              MIME type context, Base64-decode the "Data" field to
              retrieve the intended message.
</li>
</ol>

<p>
</p>
<a name="sec.certificates"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2.1"></a><h3>4.4.2.1.&nbsp;
Certificate Processing</h3>

<p>JSMS uses the "CertChain" element to carry certificate
            chains.  For the moment, each certificate in the chain is
            expected to be a PKIX certificate BER-encoded then
            Base64-encoded.  Future versions of this document will
            likely specify other valid certificate formats, since one
            of the goals of this format is to avoid . The
            meaning of the fields is described below:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>Type:</dt>
<dd>The type of the certificate chain. The
                only defined value is "PKIX", referring to PKIX <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> certificates.
</dd>
<dt></dt>
<dd>
</dd>
<dt>Chain:</dt>
<dd>An array of certificate values. In the
                case of "PKIX" certificates this is a list of base64-encoded
                DER/BER PKIX certificate values. PKIX certificates MUST be
                represented in order with each certificate certifying the next
                and the final certificate representing the end-entity.
</dd>
</dl></blockquote>
<br /><hr class="insert" />
<a name="fig.pkixchain"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "Type":"PKIX",
    "Chain":[
        "MIICPjCCAaegAwIBAgIBETANBgkqhkiG9w0BAQUFADBDMRMwEQ
         YKCZImiZPyLGQBGRYDY29tMRcwFQYKCZImiZPyLGQBGRYHZXhh
         bXBsZTETMBEGA1UEAxMKRXhhbXBsZSBDQTAeFw0wNDA0MzAxND
         I1MzRaFw0wNTA0MzAxNDI1MzRaMEMxEzARBgoJkiaJk/IsZAEZ
         FgNjb20xFzAVBgoJkiaJk/IsZAEZFgdleGFtcGxlMRMwEQYDVQ
         QDEwpFeGFtcGxlIENBMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCB
         iQKBgQDC15dtKHCqW88jLoBwOe7bb9Ut1WpPejQt+SJyR3Ad74
         DpyjCMAMSabltFtG6l5myUDfqR6UD8JZ3Ht2gZVo8RcGrX8ckR
         Tzp+P5mNbnaldF9epFVT5cdoNlPHHTsSpoX+vW6hyt81UKwI17
         m0flz+4qMs0SOEqpjAm2YYmmhH6QIDAQABo0IwQDAdBgNVHQ4E
         FgQUCGivhTPIOUp6+IKTjnBqSiCELDIwDgYDVR0PAQH/BAQDAg
         EGMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEA
         bPgCdKZh4mQEplQMbHITrTxH+/ZlE6mFkDPqdqMm2fzRDhVfKL
         fvk7888+I+fLlS/BZuKarh9Hpv1X/vs5XK82aIg06hNUWEy7yb
         uMitxV5G2QsOjYDhMyvcviuSfkpDqWrvimNhs25HOL7oDaNnXf
         P6kYE8krvFXyUl63zn2KE=",
        "MIICcTCCAdqgAwIBAgIBEjANBgkqhkiG9w0BAQUFADBDMRMwEQ
         YKCZImiZPyLGQBGRYDY29tMRcwFQYKCZImiZPyLGQBGRYHZXhh
         bXBsZTETMBEGA1UEAxMKRXhhbXBsZSBDQTAeFw0wNDA5MTUxMT
         Q4MjFaFw0wNTAzMTUxMTQ4MjFaMEMxEzARBgoJkiaJk/IsZAEZ
         FgNjb20xFzAVBgoJkiaJk/IsZAEZFgdleGFtcGxlMRMwEQYDVQ
         QDEwpFbmQgRW50aXR5MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCB
         iQKBgQDhauQDMJcCPPQQ87UeTX8Ue/b10HjppIrwo3Xs7bZWln
         +ImYWa8j5od4frntGfwLQX3KuJI6QdfhYjTE+oTfUxuHyq4xpJ
         CfRLJtsnZzCCEgFK6Rq2wQxTi2z8L3pD7DM2fjKye9WqzwEUxh
         LsE/ItFHqLIVgUE0xGo5ryFpX/IwIDAQABo3UwczAhBgNVHREE
         GjAYgRZlbmQuZW50aXR5QGV4YW1wbGUuY29tMB0GA1UdDgQWBB
         QXe5Iw/0TWZuGQECJsFk/AjkHdbTAfBgNVHSMEGDAWgBQIaK+F
         M8g5Snr4gpOOcGpKIIQsMjAOBgNVHQ8BAf8EBAMCBsAwDQYJKo
         ZIhvcNAQEFBQADgYEAACAoNFtoMgG7CjYOrXHFlRrhBM+urcdi
         FKQbNjHA4gw92R7AANwQoLqFb0HLYnq3TGOBJl7SgEVeM+dwRT
         s5OyZKnDvyJjZpCHm7+5ZDd0thi6GrkWTg8zdhPBqjpMmKsr9z
         1E3kWORi6rwgdJKGDs6EYHbpc7vHhdORRepiXc0="
    ]
}</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: PKIX CertChain Example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The recipient MUST verify the certificate chain (in the
            case of PKIX certificates according to <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>). If any validation failure
            occurs, the implementation MUST abort processing and
            return an error.
</p>
<p>Once the certificate chain is validated, the end-entity
            certificate must contain an identity which matches the "Signer"
            field. In the case of PKIX certificates, the certificate MUST
            contain a subjectAltName field of type
            "uniformResourceIdentifier". This field MUST be equivalent to the
            URI in the "Signer" field. If not, an error MUST be returned.
</p>
<a name="sec.encrypted"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Encrypted Data</h3>

<p>An "encrypted" message contains an encrypted "Content"
        block. All "encrypted" messages contain a symmetric integrity
        check, either via a MAC or via an AEAD <a class='info' href='#RFC5116'>[RFC5116]<span> (</span><span class='info'>McGrew, D., &ldquo;An Interface and Algorithms for Authenticated Encryption,&rdquo; January&nbsp;2008.</span><span>)</span></a> algorithm such as Galois/Counter Mode
        (GCM: <a class='info' href='#GCM'>[GCM]<span> (</span><span class='info'>National Institute of Standards and Technology (NIST), &ldquo;Recommendation for Block Cipher Modes of Operation:           Galois/Counter Mode (GCM) and GMAC,&rdquo; November&nbsp;2007.</span><span>)</span></a>). A message may be encrypted to an
        arbitrary number of recipients. Each recipient is represented
        by a "Recipient" block, which contains a copy of the keying
        material encrypted for that recipient. Both symmetric and
        asymmetric key establishment is supported. In order to support
        both integrity and encryption, what is carried in the
        Recipient block is a Content Master Key (CMK) which is then
        used with a Key Derivation Function (KDF) to generate the
        Content Encryption Key (CEK) used to encrypt the message and
        the Content Integrity Key (CIK) used with the MAC. In addition
        to the required fields from <a class='info' href='#sec.message-common'>Section&nbsp;4.3<span> (</span><span class='info'>Common Elements</span><span>)</span></a> the fields in an encrypted
        message are:
</p>
<p>
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Recipients:</dt>
<dd>The list of recipients. This is
            an array of Recipient objects, each of which establishes
            the CMK for that recipient.
</dd>
<dt>KDF:</dt>
<dd>Specifies the key derivation function used to
            generate the CEK and the CIK from the CMK. This field MAY be
            absent if an AEAD algorithm is used, in which case the CEK is
            derived by copying the CMK.
</dd>
<dt>Encryption:</dt>
<dd>Specifies the properties of the
            encryption. The Algorithm field MUST contain the encryption algorithm
            and the IV field specifies the initialization vector (if required
            for the algorithm).  This field MUST be present.
</dd>
<dt>Integrity:</dt>
<dd>Specifies the properties of the integrity
            check. The Algorithm field MUST contain the MAC algorithm and the
            Value field MUST contain the MAC. This field MAY be absent if no
            integrity check is used.
</dd>
<dt>Data:</dt>
<dd>Contains the ciphertext.
</dd>
</dl></blockquote>

<p>Each Recipient object provides an encrypted copy of the CMK for a
        single recipient.  The meaning of the fields is described below:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>KEKidentifier</dt>
<dd>Describes the key encrypting
            key (KEK) used to encrypt the CMK.  Either a
            "RecipientName" or a "KeyIdentifier" MUST be provided. If
            the "RecipientName" is provided, then a
            "CertificateDigest" SHOULD be provided.
</dd>
<dt></dt>
<dd>
<blockquote class="text"><dl>
<dt>RecipientName:</dt>
<dd>Provides the recipient's name in
                URI form.
</dd>
<dt>CertificateDigest:</dt>
<dd>For now, the SHA-1
                fingerprint of the PKIX certificate associated with
                the recipient.
</dd>
<dt>KeyIdentifier</dt>
<dd>The name of a shared symmetric key
                known to both sender and recipient. This need not be globally
                unique as long as it is unique within the recipient's
                context.
</dd>
</dl></blockquote>
</dd>
<dt>Algorithm:</dt>
<dd>The algorithm used to encrypt the
            CMK.  For now, one of "RSA-PKCS1-1.5" (meaning
            RSASSA-PKCS1-v1_5 as specified in <a class='info' href='#RFC3447'>[RFC3447]<span> (</span><span class='info'>Jonsson, J. and B. Kaliski, &ldquo;Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1,&rdquo; February&nbsp;2003.</span><span>)</span></a>) or "AES-256-CBC" (meaning <a class='info' href='#FIPS-180-3'>[FIPS&#8209;180&#8209;3]<span> (</span><span class='info'>National Institute of Standards and Technology (NIST), &ldquo;Secure Hash Standard (SHS),&rdquo; October&nbsp;2008.</span><span>)</span></a>).  Note the JSMS only supports key
            transport and not key agreement (since key agreement can
            always be turned into key transport).
</dd>
<dt>Value:</dt>
<dd>The CMK encrypted under the specified
            algorithm and key.
</dd>
</dl></blockquote>

<a name="sec.encryption"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.1"></a><h3>4.5.1.&nbsp;
Message Encryption</h3>

<p>The message encryption process is as follows.
</p>
<p></p>
<ol class="text">
<li>Generate a random CMK. The CMK MUST have a length at least
              equal to that of the larger of the required integrity or
              encryption keys and MUST be generated randomly. See <a class='info' href='#RFC4086'>[RFC4086]<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a> for considerations on generating random
              values. [[ TODO - we need a section on generating randomness in
              browsers - it's easy to screw up ]]
</li>
<li>Encrypt the CMK for each recipient (see <a class='info' href='#sec.encrypt_cmk'>Section&nbsp;4.5.4<span> (</span><span class='info'>CMK Encryption</span><span>)</span></a>)
</li>
<li>Generate a random IV (if required for the algorithm).
</li>
<li>Run the key derivation algorithm (see <a class='info' href='#sec.key_derivation'>Section&nbsp;4.5.3<span> (</span><span class='info'>Key Derivation</span><span>)</span></a>) to generate the CEK and CIK
              (if not using an AEAD algorithm).
</li>
<li>Serialize the content into a bitstring M.
</li>
<li>Encrypt M using the CEK and IV to form the bitstring C.
</li>
<li>Set the Value element equal to the base64-encoded
              representation of C.
</li>
<li>If not using an AEAD algorithm, compute the function
              I = MAC(CIK, C) using the chosen integrity
              algorithm. Note that this is EtA encryption which is
              considered the best cryptographic choice (See: <a class='info' href='#krawczyk-ate'>[krawczyk&#8209;ate]<span> (</span><span class='info'>Krawczyk, H., &ldquo;The Order of Encryption and Authentication for           Protecting Communications (or: How Secure Is SSL?),&rdquo; .</span><span>)</span></a>). Set the Integrity.Value
              element equal to the base64-encoded representation of
              I.
</li>
</ol>

<a name="sec.decryption"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.2"></a><h3>4.5.2.&nbsp;
Message Decryption</h3>

<p>The message decryption process is the reverse of the encryption
          process.
</p>
<p></p>
<ol class="text">
<li>Identify a Recipient block which appears to reference a key
              known to the recipient.
</li>
<li>Decrypt the CMK. If this fails and another Recipient block
              appears plausible, that MAY be tried.
</li>
<li>Run the key derivation algorithm (see <a class='info' href='#sec.key_derivation'>Section&nbsp;4.5.3<span> (</span><span class='info'>Key Derivation</span><span>)</span></a>) to generate the CEK and CIK
              (if not using an AEAD algorithm).
</li>
<li>If not using an AEAD algorithm, compute the integrity check
              value I' on the binary representation of the Value element using
              the indicated integrity check. If the Integrity.Value does not
              match I', then an error MUST be reported and processing MUST be
              aborted.
</li>
<li>Decrypt the binary representation of the Value element and
              output the result
</li>
</ol>

<a name="sec.key_derivation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.3"></a><h3>4.5.3.&nbsp;
Key Derivation</h3>

<p>The key derivation process converts the CMK into a CEK. It
          assumes as a primitive a Key Derivation Function (KDF) which
          notionally takes three arguments: </p>
<blockquote class="text"><dl>
<dt>MasterKey:</dt>
<dd>The master key used to compute the
              individual use keys
</dd>
<dt>Label:</dt>
<dd>The use key label, used to differentiate
              individual use keys
</dd>
<dt>Length:</dt>
<dd>The length of the desired use key
</dd>
</dl></blockquote><p> The only real KDF specified in this document is the TLS
          PRF, which is invoked as PRF(MasterKey, Label) with an empty seed
          and produces an arbitrary length output. The appropriate number of
          bits (Length) is simply extracted from the beginning of the output.
          The KDF name "P_XXX" in this document refers the the TLS <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> PRF using P_XXX as the underlying P_hash
          function. 
</p>
<p>To compute the CEK from the CMK, the label "Encryption" is
          used.
</p>
<p>To compute the CIK from the CMK, the label "Integrity" is
          used.
</p>
<p>When AEAD algorithms are used the KDF element MUST NOT be
          present. When they are not used, it MUST be present.
</p>
<a name="sec.encrypt_cmk"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.4"></a><h3>4.5.4.&nbsp;
CMK Encryption</h3>

<p>JSMS supports two forms of CMK encryption:
</p>
<p></p>
<ul class="text">
<li>Asymmetric encryption under the recipient's public key.
</li>
<li>Symmetric encryption under a shared key.
</li>
</ul>

<a name="sec.asymmetric_encryption"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.4.1"></a><h3>4.5.4.1.&nbsp;
Asymmetric Encryption</h3>

<p>In the asymmetric encryption mode, the CMK is encrypted under
            the recipient's public key. The only currently defined asymmetric
            encryption mode is RSA-PKCS1-1.5, which refers to <a class='info' href='#RFC3447'>[RFC3447]<span> (</span><span class='info'>Jonsson, J. and B. Kaliski, &ldquo;Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1,&rdquo; February&nbsp;2003.</span><span>)</span></a> RSAES-PKCS1-v1_5.
</p>
<a name="sec.symmetric_encryption"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.4.2"></a><h3>4.5.4.2.&nbsp;
Symmetric Encryption</h3>

<p>In the symmetric encryption mode, the CMK is encrypted under a
            symmetric key shared between the sender and receiver. All such
            modes MUST provide integrity for the CMK. This document defines
            four such modes: AES-128-CBC, AES-256-CBC referring to the <a class='info' href='#RFC5649'>[RFC5649]<span> (</span><span class='info'>Housley, R. and M. Dworkin, &ldquo;Advanced Encryption Standard (AES) Key Wrap with Padding Algorithm,&rdquo; September&nbsp;2009.</span><span>)</span></a> AES key wrapping modes and AES-128-GCM,
            AES-256-GCM, referring to AES encryption with GCM. For GCM the
            random 64-bit IV is prepended to the ciphertext.
</p>
<a name="sec.msg-composition"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Composition</h3>

<p>This document does not specify a combination signed and encrypted
        mode. However, because the contents of a message can be arbitrary, and
        encryption and data origin authentication can be provided by
        recursively encapsulating multiple JSMS messages. In general, senders
        SHOULD sign the message and then encrypt the result (thus encrypting
        the signature). This prevents attacks in which the signature is
        stripped, leaving just an encrypted message, as well as providing
        privacy for the signer.
</p>
<a name="sec.version"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Version Processing</h3>

<p>For the moment, all version numbers in the protocol MUST be
      1.0.  Receivers MUST return an error for any other version
      number.  More interesting version processing will be defined in
      the future.
</p>
<a name="sec.iana-cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>[TODO] </p>
<ul class="text">
<li>Register MIME types
</li>
<li>Registries for signature, encryption, MAC
</li>
<li>Well known HTTP URLs
</li>
</ul>

<a name="sec.sec-cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>Much more to follow here.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3339">[RFC3339]</a></td>
<td class="author-text"><a href="mailto:GK@ACM.ORG">Klyne, G., Ed.</a> and <a href="mailto:chris.newman@sun.com">C. Newman</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>,&rdquo; RFC&nbsp;3339, July&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3339.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3339.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3339.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3447">[RFC3447]</a></td>
<td class="author-text">Jonsson, J. and B. Kaliski, &ldquo;<a href="http://tools.ietf.org/html/rfc3447">Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1</a>,&rdquo; RFC&nbsp;3447, February&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3447.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4086">[RFC4086]</a></td>
<td class="author-text">Eastlake, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>,&rdquo; BCP&nbsp;106, RFC&nbsp;4086, June&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4086.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4627">[RFC4627]</a></td>
<td class="author-text">Crockford, D., &ldquo;<a href="http://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>,&rdquo; RFC&nbsp;4627, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4627.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4648">[RFC4648]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, October&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4648.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5116">[RFC5116]</a></td>
<td class="author-text">McGrew, D., &ldquo;<a href="http://tools.ietf.org/html/rfc5116">An Interface and Algorithms for Authenticated Encryption</a>,&rdquo; RFC&nbsp;5116, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5116.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5649">[RFC5649]</a></td>
<td class="author-text">Housley, R. and M. Dworkin, &ldquo;<a href="http://tools.ietf.org/html/rfc5649">Advanced Encryption Standard (AES) Key Wrap with Padding Algorithm</a>,&rdquo; RFC&nbsp;5649, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5649.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.zyp-json-schema">[I-D.zyp-json-schema]</a></td>
<td class="author-text">Zyp, K. and G. Court, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-zyp-json-schema-03.txt">A JSON Media Type for Describing the Structure and Meaning of JSON Documents</a>,&rdquo; draft-zyp-json-schema-03 (work in progress), November&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-zyp-json-schema-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="FIPS-180-3">[FIPS-180-3]</a></td>
<td class="author-text">National Institute of Standards and Technology (NIST), &ldquo;Secure Hash Standard (SHS),&rdquo; FIPS&nbsp;PUB 180-3, October&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.hammer-webfinger">[I-D.hammer-webfinger]</a></td>
<td class="author-text">Hammer-Lahav, E., Fitzpatrick, B., and B. Cook, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-hammer-webfinger-00.txt">The WebFinger Protocol</a>,&rdquo; draft-hammer-webfinger-00 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-hammer-webfinger-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5652">[RFC5652]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5652">Cryptographic Message Syntax (CMS)</a>,&rdquo; STD&nbsp;70, RFC&nbsp;5652, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5652.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="krawczyk-ate">[krawczyk-ate]</a></td>
<td class="author-text">Krawczyk, H., &ldquo;The Order of Encryption and Authentication for
          Protecting Communications (or: How Secure Is SSL?),&rdquo; Advances in cryptology--CRYPTO 2001&nbsp;August 2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="GCM">[GCM]</a></td>
<td class="author-text">National Institute of Standards and Technology (NIST), &ldquo;Recommendation for Block Cipher Modes of Operation:
          Galois/Counter Mode (GCM) and GMAC,&rdquo; SP&nbsp;800-38D, November&nbsp;2007.</td></tr>
</table>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
JSON Schema</h3>

<p>The following schemas formally define various namespaces used
      in this document, in conformance with <a class='info' href='#I-D.zyp-json-schema'>[I&#8209;D.zyp&#8209;json&#8209;schema]<span> (</span><span class='info'>Zyp, K. and G. Court, &ldquo;A JSON Media Type for Describing the Structure and Meaning of JSON Documents,&rdquo; November&nbsp;2010.</span><span>)</span></a>.  Because validation of
      JSON documents is optional, these schemas are not normative and
      are provided for descriptive purposes only.
</p>
<a name="schema.content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Message Contents Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"Message Contents",
    "type":"object",
    "properties":{
        "ContentType":{
            "description":"A MIME content type",
            "type":"string",
            "required":true
        },
        "Type":{
            "description":"Dictionary type",
            "type":"string",
            "enum":["content"],
            "required":true
        },
        "Data":{
            "description":"The underlying data",
            "type":"string",
            "required":true
        },
        "ID":{
            "description":"(optional) unique ID for this message",
            "type":"string"
        },
        "Created":{
            "description":"(optional) time the message was created",
            "type":"string",
            "format":"date-time"
        }
    }
}</pre></div>
<a name="schema.common"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Common Elements Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"The basic schema for a JSMS message",
    "type":"object",
    "properties":{
        "Type":{
            "description":"Message type",
            "type":"string",
            "enum":["signed", "encrypted"]
        },
        "Version":{
            "description":"Version number for the message",
            "type":"string",
            "enum":["1.0"]
        }
    }
}</pre></div>
<a name="schema.signed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Signed Message Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"A signed message",
    "type":"object",
    "extends":message_schema,
    "properties":{
        "Signature":{
            "description":"The signature over the SignedData",
            "type":"object",
            "properties":{
                "SignedData":{
                    "description":"content to be signed, Base64",
                    "type":"string",
                    "required":true
                },
                "DigestAlgorithm":{
                    "description":"",
                    "type":"string",
                    "enum":["SHA-256"]
                },
                "SignatureAlgorithm":{
                    "description":"",
                    "type":"string",
                    "enum":["RSA-PKCS1-1.5"]
                },
                "Signer":{
                    "description":"",
                    "type":"string",
                    "format":"uri",
                    "required":true
                },
                "CertChain": {
                    "description":"the signer's cert chain",
                    "type":"PKIXcertchain"
                },
                "Signature":{
                    "description":"the signature",
                    "type":"string",
                    "required":true
                }
            }
        }
    }
}</pre></div>
<a name="schema.PKIXcertchain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
PKIX Certificate Chain Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"A chain of PKIX certificates",
    "id":"PKIXcertchain",
    "properties":{
        "Type":{
            "description":"The type of certificate chain",
            "type":"string",
            "enum":["PKIX"] },
        "Chain":{
            "description":"PKIX certs ordered from root to end",
            "type":"array",
            "items":{
                "description":"A base64-encoded BER certificate",
                "type":"string"
            }
        }
    }
}</pre></div>
<a name="schema.ecncrypted"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Encrypted Message Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"An encrypted object",
    "type":"object",
    "extends":message_schema,
    "properties":{
        "Recipients":{
            "description":"The list of recipient blocks",
            "type":"array",
            "required":true,
            "items":{
                "description":"A single recipient block",
                "type":"Recipient"
            }
        },
        "KDF":{
            "description":
            "The KDF used to derive the MAC and encryption keys",
            "type":"string",
            "enum":["P_SHA256"]
        },
        "Encryption":{
            "description":"Encryption control information",
            "type":"object",
            "required":true,
            "properties":{
                "Algorithm":{
                    "description":"The algorithm used to encrypt",
                    "type":"string",
                    "enum":["AES-256-CBC"]
                },
                "IV":{
                    "description":"Initialization vector (base64)",
                    "type":"string"
                }
            }
        },
        "Integrity":{
            "description":"The integrity control information",
            "type":"object",
            "properties":{
                "Algorithm":{
                    "description":"The MAC algorithm",
                    "type":"string",
                    "enum":["HMAC-SHA-256"]
                },
                "Value":{
                    "description":"The MAC value (base64-encoded)",
                    "type":"string",
                    "required":true
                }
            }
        },
        "Data":{
            "description":"The ciphertext (Base64-encoded)",
            "type":"string",
            "required":true
        }
    }
}</pre></div>
<a name="schema.recipient"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Recipient Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
{
    "description":"The recipient of an encrypted object",
    "type":"object",
    "id":"Recipient",
    "properties":{
        "KEKidentifier":{
            "type":"object",
            "description":"Identifies the key encrypting key",
            "properties":{
                "RecipientName":{
                    "type":"string",
                    "description":"The recipient's name",
                    "format":"uri"
                },
                "CertificateDigest":{
                    "type":"string",
                    "description":"Recipient's cert fingerprint"
                },
                "KeyIdentifier":{
                    "type":"string",
                    "description": "Shared symmetric key (opaque)"
                }
            }
        },
        "Algorithm":{
            "description":"The algorithm used to protect the CMK",
            "type":"string",
            "enum":["RSA-PKCS1-1.5", "AES-256-CBC"]
        },
        "Value":{
            "description": "Base64 of the encrypted CMK",
            "type":"string"
        }
    }
}</pre></div>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Acknowledgments</h3>

<p>[TODO]
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Rescorla</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RTFM, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2064 Edgewood Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94303</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ekr@rtfm.com">ekr@rtfm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Joe Hildebrand</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1899 Wyknoop Street, Suite 600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Denver, CO  80202</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jhildebr@cisco.com">jhildebr@cisco.com</a></td></tr>
</table>
</body></html>
